--Abfrage alle Teams
SELECT 
	*
FROM Mannschaft 
ORDER BY TeamID;

--Abfrage Mannschaften pro Saison (sollten immer 18 sein)
SELECT 
	Saison, 
	COUNT(*) AS Teams
FROM MannschaftSpieltInLiga
GROUP BY Saison
ORDER BY Saison;


--Abfrage Teams Saison 2005
SELECT 
    m.TeamID,
    m.Name AS Team,
    ms.LigaName,
    ms.Saison
FROM MannschaftSpieltInLiga ms
JOIN Mannschaft m 
    ON ms.TeamID = m.TeamID
WHERE ms.LigaName = 'Bundesliga'
  AND ms.Saison = 2005
ORDER BY m.Name;

--Abfrage Alle Spiele Bayern München
SELECT 
    s.MatchID,
    s.MatchDateTime,
    s.Ort,
    ht.Name AS Heimteam,
    gt.Name AS Gastteam,
    e.GoalsHeimmannschaft AS Tore_Heim,
    e.GoalsGastmannschaft AS Tore_Gast
FROM Spiel s
JOIN MannschaftSpieltSpiel mss
    ON s.MatchID = mss.MatchID
JOIN Mannschaft ht 
    ON ht.TeamID = mss.Heimannschaft
JOIN Mannschaft gt 
    ON gt.TeamID = mss.Gastmannschaft
JOIN Ergebnis e
    ON e.MatchID = s.MatchID
WHERE (mss.Heimannschaft = 40 OR mss.Gastmannschaft = 40)
  AND e.isHalbzeitErgebnis = 0        -- Nur Endergebnis
ORDER BY s.MatchDateTime;

--Abfrage Mannschaften nach MatchID
SELECT 
    s.MatchID,
    s.Saison,
    s.Spieltag,
    mh.Name AS Heimteam,
    mg.Name AS Gastteam
FROM Spiel s
JOIN MannschaftSpieltSpiel mss ON mss.MatchID = s.MatchID
JOIN Mannschaft mh ON mh.TeamID = mss.Heimannschaft
JOIN Mannschaft mg ON mg.TeamID = mss.Gastmannschaft
WHERE s.MatchID = 123456;   -- <- MatchID hier eintragen

--Alle Tore mit Spielernamen
SELECT
    Tor.GoalID,
    Tor.MatchID,
    Tor.Spielminute,
    Spieler.Name AS Spielername
FROM Tor
JOIN SpielerSchiesstTor sst ON sst.GoalID = Tor.GoalID
JOIN Spieler ON Spieler.SpielerID = sst.SpielerID
ORDER BY Tor.MatchID, Tor.Spielminute;

--Alle Eigentore
SELECT 
    Spieler.Name AS Spieler, 
    Tor.MatchID, 
    Tor.Spielminute
FROM SpielerSchiesstTor sst
JOIN Spieler ON Spieler.SpielerID = sst.SpielerID
JOIN Tor ON Tor.GoalID = sst.GoalID
WHERE sst.isOwnGoal = 1
ORDER BY Tor.MatchID, Tor.Spielminute;

--Alle Elfmeter-Tore
SELECT 
    Spieler.Name AS Spieler,
    Tor.MatchID,
    Tor.Spielminute
FROM SpielerSchiesstTor sst
JOIN Spieler ON Spieler.SpielerID = sst.SpielerID
JOIN Tor ON Tor.GoalID = sst.GoalID
WHERE sst.isPenalty = 1
ORDER BY Tor.MatchID, Tor.Spielminute;

--Alle Spieler mit Anzahl der Tore
SELECT 
    Spieler.Name,
    COUNT(sst.GoalID) AS Tore
FROM Spieler
LEFT JOIN SpielerSchiesstTor sst ON sst.SpielerID = Spieler.SpielerID
GROUP BY Spieler.SpielerID
ORDER BY Tore DESC;

--Spiler mit Mannschaften und Saisons
SELECT 
    Spieler.Name,
    ssm.TeamID,
    m.Name AS Teamname,
    ssm.Saison
FROM SpielerSpieltInMannschaft ssm
JOIN Spieler ON Spieler.SpielerID = ssm.SpielerID
JOIN Mannschaft m ON m.TeamID = ssm.TeamID
ORDER BY Spieler.Name, ssm.Saison;

--Fall Granit Xhaka aktuell noch falsche Daten
SELECT 
	Spieler.Name, 
	ssm.TeamID, m.Name AS Teamname, 
	ssm.Saison 
FROM SpielerSpieltInMannschaft ssm 
JOIN Spieler 
	ON Spieler.SpielerID = ssm.SpielerID 
JOIN Mannschaft m 
	ON m.TeamID = ssm.TeamID
Where Spieler.Name = 'Granit Xhaka'
ORDER BY Spieler.Name, ssm.Saison;


--Liste alle Eigentore
SELECT
    Spieler.Name AS Spielername,
    s.Saison,
    s.Spieltag,
    mh.Name AS Heimteam,
    mg.Name AS Gastteam,
    Tor.MatchID,
    Tor.Spielminute
FROM SpielerSchiesstTor sst
JOIN Tor ON Tor.GoalID = sst.GoalID
JOIN Spieler ON Spieler.SpielerID = sst.SpielerID
JOIN Spiel s ON s.MatchID = Tor.MatchID
JOIN MannschaftSpieltSpiel mss ON mss.MatchID = s.MatchID
JOIN Mannschaft mh ON mh.TeamID = mss.Heimannschaft
JOIN Mannschaft mg ON mg.TeamID = mss.Gastmannschaft
WHERE sst.isOwnGoal = 1
ORDER BY Tor.MatchID, s.Saison, s.Spieltag, Tor.Spielminute;

--Zweite Bundesliga Tests

--Alle Teams die jemals in der 2. Bundesliga gespielt haben
SELECT DISTINCT m.Name
FROM MannschaftSpieltInLiga msl
JOIN Mannschaft m ON m.TeamID = msl.TeamID
WHERE msl.LigaName = 'Zweite Bundesliga'
ORDER BY m.Name;

--Alles Spiele einer Saison der zweiten Liga
SELECT 
    s.MatchID,
    s.Saison,
    s.Spieltag,
    mh.Name AS Heimteam,
    mg.Name AS Gastteam
FROM Spiel s
JOIN MannschaftSpieltSpiel mss ON mss.MatchID = s.MatchID
JOIN Mannschaft mh ON mh.TeamID = mss.Heimannschaft
JOIN Mannschaft mg ON mg.TeamID = mss.Gastmannschaft
JOIN MannschaftSpieltInLiga msl 
    ON msl.TeamID = mh.TeamID AND msl.Saison = s.Saison
WHERE msl.LigaName = 'Zweite Bundesliga'
ORDER BY s.Spieltag, s.MatchID;

--Alle Tore der zweiten Bundesliga
SELECT 
    Spieler.Name AS Torschütze,
    s.Saison,
    s.Spieltag,
    mh.Name AS Heimteam,
    mg.Name AS Gastteam,
    Tor.Spielminute,
    Tor.MatchID
FROM Tor
JOIN Spiel s ON s.MatchID = Tor.MatchID
JOIN SpielerSchiesstTor sst ON sst.GoalID = Tor.GoalID
JOIN Spieler ON Spieler.SpielerID = sst.SpielerID
JOIN MannschaftSpieltSpiel mss ON mss.MatchID = s.MatchID
JOIN Mannschaft mh ON mh.TeamID = mss.Heimannschaft
JOIN Mannschaft mg ON mg.TeamID = mss.Gastmannschaft
JOIN MannschaftSpieltInLiga msl ON msl.TeamID = mh.TeamID AND msl.Saison = s.Saison
WHERE msl.LigaName = 'Zweite Bundesliga'
WHERE 
ORDER BY s.Saison, s.Spieltag, Tor.MatchID, Tor.Spielminute;

--Beste Torschützen in der Zweiten Liga
SELECT
    Spieler.Name,
    COUNT(*) AS Tore
FROM SpielerSchiesstTor sst
JOIN Tor ON Tor.GoalID = sst.GoalID
JOIN Spiel s ON s.MatchID = Tor.MatchID
JOIN Spieler ON Spieler.SpielerID = sst.SpielerID
JOIN MannschaftSpieltInLiga msl 
    ON msl.TeamID = (SELECT TeamID 
                     FROM SpielerSpieltInMannschaft 
                     WHERE SpielerID = Spieler.SpielerID AND Saison = s.Saison)
WHERE sst.isOwnGoal = 0
  AND msl.LigaName = 'Zweite Bundesliga'
GROUP BY Spieler.SpielerID
ORDER BY Tore DESC;

--Alle Daten löschen
DELETE FROM SpielerSchiesstTor;
DELETE FROM SpielerSpieltInMannschaft;
DELETE FROM Tor;
DELETE FROM Spieler;
DELETE FROM Ergebnis;
DELETE FROM MannschaftSpieltSpiel;
DELETE FROM Spiel;
DELETE FROM MannschaftSpieltInLiga;
DELETE FROM Mannschaft;


33316
66832
66885
72214
72439